{% extends 'blog/base.html' %}
{% load crispy_forms_tags %}
{% block title %}Profile{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">

    <!-- Profile Header -->
    <h2 class="text-3xl font-bold mb-6 text-center">{{ user.username }}'s Profile</h2>

    <!-- Tabs -->
    <div class="tabs tabs-boxed justify-center mb-6">
        <a href="?section=profile" class="tab {% if section == 'profile' %}tab-active{% endif %}">Profile</a>
        <a href="?section=posts" class="tab {% if section == 'posts' %}tab-active{% endif %}">My Posts</a>
        <a href="?section=update" class="tab {% if section == 'update' %}tab-active{% endif %}">Update Profile</a>
    </div>

    <!-- Profile Section -->
    {% if section == 'profile' %}
        <div class="card bg-base-100 shadow-xl p-6 rounded-lg">
            <p><strong>Full Name:</strong> {{user.first_name }} {{user.last_name}}</p>
            <p><strong>Username:</strong> {{ user.username }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
        </div>

    <!-- Posts Section -->
    {% elif section == 'posts' %}
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">My Posts</h3>
            <a href="{% url 'post_create' %}" class="btn btn-primary btn-sm hover:scale-105 transition-transform">+ New Post</a>
        </div>

        <div class="space-y-4">
            {% for post in posts %}
                <div class="card bg-base-100 shadow-lg p-4 flex justify-between rounded-lg">
                    <div>
                        <a href="{% url 'post_details' post.id %}" class="text-lg font-semibold hover:underline">
                            {{ post.title }}
                        </a>
                        <p class="text-sm text-gray-500">Category: {{ post.category.name }}</p>
                        <p class="text-sm text-gray-500 mt-2">Tags: {% for tag in post.tag.all %}
                                                                    <span class="badge badge-outline">{{ tag.name }}</span>
                                                                    {% empty %}
                                                                        No tags
                                                                    {% endfor %} </p>
                    </div>
                    <div class="flex justify-between items-end">
                        <div class="flex gap-2 mt-4">
                            <a href="{% url 'post_details' post.id %}" class="btn btn-sm btn-outline">Read More</a>
                            <a href="{% url 'post_update' post.id %}" class="btn btn-sm btn-outline hover:bg-blue-500">‚úèÔ∏èEdit</a>
                            <a href="{% url 'post_delete' post.id %}" class="btn btn-sm btn-error"
                            onclick="return confirm('Are you sure you want to delete this post?');">üóëÔ∏èDelete</a>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Created: {{ post.created_at|date:"M d, Y H:i" }}</span>
                            {% if post.was_updated %}
                                <span class="text-sm ms-2 text-green-600">Updated: {{ post.update_at|date:"M d, Y H:i" }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% empty %}
                <p class="text-gray-600 text-center">You haven't created any posts yet.</p>
            {% endfor %}
        </div>

    <!-- Update Profile Section -->
    {% elif section == 'update' %}

        <div class="max-w-xl">
            <h3 class="text-xl font-semibold mb-4">Update Profile</h3>
            <form method="post" class="space-y-4">
                {% csrf_token %}
            {{form.media}}{{form | crispy}}  
                <button class="btn btn-primary">Update</button>
            </form>
        </div>
    {% endif %}
</div>
{% endblock %}
